<!DOCTYPE HTML>
<html>
	<head>
		<style>
			body {
				margin: 0px;
				padding: 0px;
			}

			.kineticjs-content {
				background-color: #eee;
			}

			.kineticjs-content {
				background-image: url('images/evento1_1.jpg');
			}
		</style>
	</head>
	<body>
		<div id="container"></div>
		<!--<script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.2.min.js"></script>-->
		<script src="http://www.html5canvastutorials.com/lib/KineticJS/kinetic-v5.0.1-beta.js"></script>
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="js/obtEv.js"></script>
		<script defer="defer">

			$(document).ready(function() {

				obtEventos('event1.json');

				var stage = new Kinetic.Stage({
					container: 'container',
					width: 1000,
					height: 600
				});

				var layer = new Kinetic.Layer();
				var layer2 = new Kinetic.Layer();
				var layer3 = new Kinetic.Layer();

				var texto = "";
				var rderepeat= new Kinetic.Text({
					x: 600,
					y: 500,
					text: 'R',
					fontSize: 20,
					width: 600,
					padding: 20,
					fontFamily: 'Calibri',
					fill: 'green',
					align: 'center'

				});
				var textoSimple = new Kinetic.Text({
					x: 200,
					y: 500,
					text: texto,
					fontSize: 20,
					width: 600,
					padding: 20,
					fontFamily: 'Calibri',
					fill: 'blue',
					align: 'center'
				});
				layer.add(textoSimple);
				layer.add(rderepeat);
		
				var pregunta = new Kinetic.Text({
					x: 200,
					y: 200,
					width: 600,
					text: "Nothing",
					padding: 20,
					fontFamily: 'Calibri',
					fontSize: 20,
					fill: 'red',
					align: 'center',
					visible: false
				});

				var r1 = new Kinetic.Text({
					x: 200,
					y: 230,
					width: 600,
					text: "r1",
					padding: 20,
					fontFamily: 'Calibri',
					fontSize: 18,
					fill: 'blue',
					align: 'center',
					visible: false
				});
				var repetir = false;
				var r2 = new Kinetic.Text({
					x: 200,
					y: 280,
					width: 600,
					text: "r2",
					padding: 20,
					fontFamily: 'Calibri',
					fontSize: 18,
					fill: 'blue',
					align: 'center',
					visible: false
				});

				var r3 = new Kinetic.Text({
					x: 200,
					y: 330,
					width: 600,
					text: "r3",
					padding: 20,
					fontFamily: 'Calibri',
					fontSize: 18,
					fill: 'blue',
					align: 'center',
					visible: false
				});

				var backBox = new Kinetic.Rect({
					x: 200,
					y: 100,
					fill: '#eee',
					height: pregunta.height() + 300,
					width: 600,
					cornerRadius: 10,
					visible: false

				});

					var menuback = new Kinetic.Rect({
						x:810,
						y:100,
					 	stroke: '#555',
        				strokeWidth: 5,
        				fill: '#ddd',
        				width: 100,
        				height: 60,
        				shadowColor: 'black',
        				shadowBlur: 10,
        				shadowOffset: {x:10,y:10},
        				shadowOpacity: 0.2,
       					 cornerRadius: 10
					});
					 
					var menu = new Kinetic.Text ({

							x:560,
							y:100,						
							text: 'Menu',
							fontSize: 20,
							width: 600,
							padding: 20,
							fontFamily: 'Calibri',
							fill: '#000',
							align: 'center'


					});

					var ventmenu = new Kinetic.Rect ({
						x: 200,
						y: 100,
						fill: '#000',
						height: 400,
						width: 600,
						cornerRadius: 10,						
						visible : false

					})
					var cargar = new Kinetic.Text ({
							x:200,
							y:200,
							width:600,
							text: 'Cargar',
							fontSize: 50,							
							padding: 20,
							fontFamily: 'Calibri',
							fill: '#fff',
							align: 'center',
							visible: false
					})
					
						var sonidooff = new Kinetic.Text ({
							x:200,
							y:300,
							width:600,
							text: 'Sonido Off',
							fontSize: 50,							
							padding: 20,
							fontFamily: 'Calibri',
							fill: '#fff',
							align: 'center',
							visible:false
					})
						
						var salir = new Kinetic.Text ({
							x:200,
							y:400,
							width:600,
							text: 'Salir',
							fontSize: 50,							
							padding: 20,
							fontFamily: 'Calibri',
							fill: '#fff',
							align: 'center',
							visible: false

					})

				
				
				layer2.add(backBox);
				layer2.add(pregunta);
				layer2.add(r1);
				layer2.add(r2);
				layer2.add(r3);

				layer3.add(ventmenu);
				layer3.add(cargar);
				layer3.add(sonidooff);
				layer3.add(salir);
				layer3.add(menuback);
				layer3.add(menu);

				stage.add(layer2);
				stage.add(layer);
				stage.add(layer3);

				var anim = new Kinetic.Animation(function(frame) {
					// hexagon.setX(amplitude * Math.sin(frame.time * 2 * Math.PI / period) + centerX);
					// tipoA.setX(tipoA.x() + velA);
					// tipoB.setX(tipoB.x() + velB);
					textoSimple.setText(texto);
				}, layer);

				anim.start();

				var showthem = false;
				var pregInf = [];
				var anim2 = new Kinetic.Animation(function(frame) {
					if (showthem) {
						r1.setText("1. " + pregInf[1]['T']);
						r2.setText("2. " + pregInf[2]['T']);
						r3.setText("3. " +pregInf[3]['T']);
						pregunta.setText(pregInf[0]);
						pregunta.show();
						r1.show();
						r2.show();
						r3.show();
						
						backBox.show();
						textoSimple.hide();
					} else {
						pregunta.hide();
						r1.hide();
						r2.hide();
						r3.hide();
						backBox.hide();
						textoSimple.show();
					}
					// Todo con respecto a el texto con preguntas
				}, layer2);

				anim2.start();

				// Esto es solo para el menu
				var anim3 = new Kinetic.Animation(function(frame) {
					if (menux) {
						ventmenu.show();
						cargar.show();
						sonidooff.show();
						salir.show();	
					} else {
						ventmenu.hide();
						cargar.hide();
						sonidooff.hide();
						salir.hide();	
					}
				}, layer3);
				anim3.start()
				// Fin de la situacion para el menu

				var data;

				function modVals() {					// Modificaremos y jalaremos el siguiente evento cada 10s
					if (!repetir) {
						data = sgteEv();
					}
					if (data[0]	== 'e') {
						texto = data[1];

						// REPRODUCIR AUDIO

						var sound = new Audio(data[2]);
						// var duration = sound.duration;
						// console.log("###... " + duration);
						sound.play();

						// CAMBIAR IMAGEN

						$('.kineticjs-content').css('background-image', 'url(' + data[3] + ')');

					} else if (data[0] == 'f') {
						showthem = true;
						var sound = new Audio(data[5]);
						sound.play();
						pregInf = [data[1], data[2], data[3], data[4]];
						return;
					} else {

						console.log("NEXT!");
					}
					
					setTimeout ( function() {
						modVals();								// Llamamos a la misma funcion
					}, 10000);
					repetir = false;						// Luego de repetirlo, regresar repetir a false
				}
				
				modVals();

				rderepeat.on('click', function(){
					console.log("REPETIRRR!!L KJALSKJDF");
					repetir = true;

				});

				var menux = false;

				menu.on('click',function(){	
					
					console.log('Hizo click #$%"$');
					menux = true;
				});

				ventmenu.on('mouseout', function() {
					console.log('Salio del menu');
					menux = false;
				});
								
				r1.on('click', function() {
					// alert('Hizo click en la primera!');
					console.log('moviendose para la respuesta!');
					if (pregInf[1]['tipo'] == 'c') {
						obtEventos(pregInf[1]['go']);						
						showthem = false;
						modVals();
					} else {
						console.log('mostrar imagen');
					}
				});
				r2.on('click', function() {
					// alert('Hizo click en la Segunda!');
					console.log('moviendose para la respuesta!');
					if (pregInf[2]['tipo'] == 'c') {
						obtEventos(pregInf[2]['go']);						
						showthem = false;
						modVals();
					} else {
						console.log('mostrar imagen');
					}
				});
				r3.on('click', function() {
					// alert('Hizo click en la Tercera!');
					console.log('moviendose para la respuesta!');
					if (pregInf[3]['tipo'] == 'c') {
						obtEventos(pregInf[3]['go']);						
						showthem = false;
						modVals();
					} else {
						console.log('mostrar imagen');
					}
				});
			});
		</script>
	</body>
</html>			 
